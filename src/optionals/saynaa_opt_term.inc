/*
 * Copyright (c) 2022-2023 Mohamed Abdifatah. All rights reserved.
 * Distributed Under The MIT License
 */

#ifndef STD_TERM_INC
#define STD_TERM_INC

const char ext_term[] = "import io\n"
"from time import clock, sleep\n"
"from types import ByteBuffer\n"
"## The configuration that should be used to create tui context\n"
"## and run.\n"
"class Config\n"
"  function _init()\n"
"    this.title = null\n"
"    this.fps = 60\n"
"    this.hide_cursor = false\n"
"    this.capture_events = false\n"
"    this.new_buffer = false\n"
"    this.init_fn = null\n"
"    this.event_fn = null\n"
"    this.frame_fn = null\n"
"    this.cleanup_fn = null    \n"
"  end\n"
"end\n"
"## Interlan context contains draw buffer and other data.\n"
"class _Context\n"
"  function _init()\n"
"    this.buff = ByteBuffer()\n"
"    this.clear()\n"
"  end\n"
"  \n"
"  ## Called to reset all the internal for reusing the context.\n"
"  function clear()\n"
"    this.config = null\n"
"    this.buff.clear()\n"
"    this.done = false ## If true the main loop ends.\n"
"  end\n"
"end\n"
"## Internal global context.\n"
"_ctx = _Context()\n"
"## -------------------------------------------------------------------------\n"
"## FUNCTIONS\n"
"## -------------------------------------------------------------------------\n"
"## Flush all the buffered bytes in the context's buffer.\n"
"function flush()\n"
"  io.write(io.stdout, _ctx.buff.string())\n"
"  io.flush()\n"
"  _ctx.buff.clear()\n"
"end\n"
"## Stops the main loop and return from run().\n"
"function stop()\n"
"  _ctx.done = true\n"
"end\n"
"function set_title(title)\n"
"  io.write(io.stdout, '\x1b]0;$title\x07')\n"
"end\n"
"function hide_cursor()\n"
"  io.write(io.stdout, '\x1b[?25l')\n"
"end\n"
"function show_cursor()\n"
"  io.write(io.stdout, '\x1b[?25h')\n"
"end\n"
"## It'll write escape sequence to move the cursor but not actually move.\n"
"## for this to make effect, one should flush the buffer.\n"
"function setposition(x, y)\n"
"  _ctx.buff.write('\x1b[${y + 1};${x + 1}H')\n"
"end\n"
"## \n"
"## Hex    ASCII  DEC-Line-Drawing\n"
"## ------------------------------\n"
"##  0x6a    j        ┘\n"
"##  0x6b    k        ┐\n"
"##  0x6c    l        ┌\n"
"##  0x6d    m        └\n"
"##  0x6e    n        ┼\n"
"##  0x71    q        ─\n"
"##  0x74    t        ├\n"
"##  0x75    u        ┤\n"
"##  0x76    v        ┴\n"
"##  0x77    w        ┬\n"
"##  0x78    x        │\n"
"##\n"
"function start_boxchar()\n"
"  _ctx.buff.write('\x1b(0')\n"
"end\n"
"function end_boxchar()\n"
"  _ctx.buff.write('\x1b(B')\n"
"end\n"
"## Write a string to the context buffer.\n"
"function write(s)\n"
"  _ctx.buff.write(str(s))\n"
"end\n"
"## Clear the screen and move cursor to (0, 0).\n"
"function clear()\n"
"  _ctx.buff.write('\x1b[H\x1b[J')\n"
"end\n"
"## Clear everythin from cursor to EOL.\n"
"function clear_eol()\n"
"  _ctx.buff.write('\x1b[K')\n"
"end\n"
"## Clear everythin from cursor to EOF.\n"
"function clear_eof()\n"
"  _ctx.buff.write('\x1b[J')\n"
"end\n"
"## Reset all the stylings.\n"
"function reset()\n"
"  _ctx.buff.write('\x1b[0m')\n"
"end\n"
"function _is_valid_color(r, g, b)\n"
"  return r is Number and g is Number and b is Number\n"
"  return r.isbyte() and g.isbyte() and b.isbyte()\n"
"end\n"
"## Set the forground color.\n"
"function start_color(r, g, b)\n"
"  assert(_is_valid_color(r, g, b))\n"
"  _ctx.buff.write('\x1b[38;2;$r;$g;${b}m')\n"
"end\n"
"## End the forground color.\n"
"function end_color()\n"
"  _ctx.buff.write('\x1b[39m')\n"
"end\n"
"## Start the background color.\n"
"function start_bg(r, g, b)\n"
"  assert(_is_valid_color(r, g, b))\n"
"  _ctx.buff.write('\x1b[48;2;$r;$g;${b}m')\n"
"end\n"
"## End the background color.\n"
"function end_bg()\n"
"  _ctx.buff.write('\x1b[49m')\n"
"end\n"
"function start_bold()\n"
"  _ctx.buff.write('\x1b[1m')\n"
"end\n"
"function end_bold()\n"
"  _ctx.buff.write('\x1b[22m')\n"
"end\n"
"function start_dim()\n"
"  _ctx.buff.write('\x1b[2m')\n"
"end\n"
"function end_dim()\n"
"  _ctx.buff.write('\x1b[22m')\n"
"end\n"
"function start_italic()\n"
"  _ctx.buff.write('\x1b[3m')\n"
"end\n"
"function end_italic()\n"
"  _ctx.buff.write('\x1b[23m')\n"
"end\n"
"function start_underline()\n"
"  _ctx.buff.write('\x1b[4m')\n"
"end\n"
"function end_underline()\n"
"  _ctx.buff.write('\x1b[24m')\n"
"end\n"
"function start_inverse()\n"
"  _ctx.buff.write('\x1b[7m')\n"
"end\n"
"function end_inverse()\n"
"  _ctx.buff.write('\x1b[27m')\n"
"end\n"
"function start_hidden()\n"
"  _ctx.buff.write('\x1b[8m')\n"
"end\n"
"function end_hidden()\n"
"  _ctx.buff.write('\x1b[28m')\n"
"end\n"
"function start_strikethrough()\n"
"  _ctx.buff.write('\x1b[9m')\n"
"end\n"
"function end_strikethrough()\n"
"  _ctx.buff.write('\x1b[29m')\n"
"end\n"
"function start_color_black()\n"
"  _ctx.buff.write('\x1b[30m')\n"
"end\n"
"function end_color_black()\n"
"  _ctx.buff.write('\x1b[40m')\n"
"end\n"
"function start_color_red()\n"
"  _ctx.buff.write('\x1b[31m')\n"
"end\n"
"function end_color_red()\n"
"  _ctx.buff.write('\x1b[41m')\n"
"end\n"
"function start_color_green()\n"
"  _ctx.buff.write('\x1b[32m')\n"
"end\n"
"function end_color_green()\n"
"  _ctx.buff.write('\x1b[42m')\n"
"end\n"
"function start_color_yellow()\n"
"  _ctx.buff.write('\x1b[33m')\n"
"end\n"
"function end_color_yellow()\n"
"  _ctx.buff.write('\x1b[43m')\n"
"end\n"
"function start_color_blue()\n"
"  _ctx.buff.write('\x1b[34m')\n"
"end\n"
"function end_color_blue()\n"
"  _ctx.buff.write('\x1b[44m')\n"
"end\n"
"function start_color_magenta()\n"
"  _ctx.buff.write('\x1b[35m')\n"
"end\n"
"function end_color_magenta()\n"
"  _ctx.buff.write('\x1b[45m')\n"
"end\n"
"function start_color_cyan()\n"
"  _ctx.buff.write('\x1b[36m')\n"
"end\n"
"function end_color_cyan()\n"
"  _ctx.buff.write('\x1b[46m')\n"
"end\n"
"function start_color_white()\n"
"  _ctx.buff.write('\x1b[37m')\n"
"end\n"
"function end_color_white()\n"
"  _ctx.buff.write('\x1b[47m')\n"
"end\n"
"function start_color_functionault()\n"
"  _ctx.buff.write('\x1b[39m')\n"
"end\n"
"function end_color_functionault()\n"
"  _ctx.buff.write('\x1b[49m')\n"
"end\n"
"## -------------------------------------------------------------------------\n"
"## TUI MAIN LOOP\n"
"## -------------------------------------------------------------------------\n"
"## Internal event dispatcher\n"
"function _dispatch(event)\n"
"  ## Windows show cursor every time the window resize.\n"
"  if event.type == EVENT_RESIZE\n"
"    if _ctx.config.hide_cursor\n"
"      hide_cursor()\n"
"    end\n"
"  end\n"
"end\n"
"function run(config)\n"
"  _ctx.config = config\n"
"  init(config.capture_events)\n"
"  \n"
"  if config.new_buffer then new_screen_buffer() end\n"
"  if config.hide_cursor then hide_cursor() end\n"
"  if config.init_fn then config.init_fn() end\n"
"  \n"
"  event = Event()\n"
"  \n"
"  ## The main loop.\n"
"  while not _ctx.done\n"
"    start = clock()\n"
"    \n"
"    ## Dispatch events.\n"
"    while read_event(event)\n"
"      _dispatch(event)\n"
"      if config.event_fn then config.event_fn(event) end\n"
"      if _ctx.done then break end\n"
"    end\n"
"    \n"
"    ## Run frame function\n"
"    if config.frame_fn then config.frame_fn() end\n"
"    \n"
"    ## Sleep to sync FPS.\n"
"    et = clock() - start ## Elapsed time.\n"
"    ft = 1 / config.fps  ## Frame time.\n"
"    \n"
"    ## TODO: set title to print fps if said in config.\n"
"    if ft > et then sleep((ft - et) * 1000) end\n"
"  end\n"
"  \n"
"  ## Cleanup.\n"
"  if config.cleanup_fn then config.cleanup_fn() end\n"
"  if config.hide_cursor then show_cursor() end\n"
"  if config.new_buffer then restore_screen_buffer() end\n"
"  cleanup()\n"
"  _ctx.clear()\n"
"  \n"
"end\n";

#endif
